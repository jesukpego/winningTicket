{% extends 'base/base.html' %}
{% load i18n %}

{% block title %}Rapport des Revenus - WINNING TICKET{% endblock %}

{% block content %}
<div class="bg-slate-950 text-white min-h-screen font-sans pb-20 pt-24">
    <!-- Header Section -->
    <section class="relative pt-16 pb-12 overflow-hidden">
        <!-- background glow effects -->
        <div class="absolute top-0 left-1/2 -translate-x-1/2 w-full h-full z-0 pointer-events-none">
            <div class="absolute top-[-20%] left-[-10%] w-[500px] h-[500px] bg-blue-600/10 rounded-full blur-[120px]">
            </div>
            <div class="absolute bottom-0 right-[-10%] w-[400px] h-[400px] bg-emerald-400/5 rounded-full blur-[100px]">
            </div>
        </div>

        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
            <div class="flex flex-col md:flex-row md:items-center justify-between gap-6">
                <div>
                    <div
                        class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-slate-800 border border-slate-700 text-xs font-medium text-emerald-400 mb-4">
                        <i class="fas fa-chart-bar"></i>
                        ANALYSE FINANCIÈRE
                    </div>
                    <h1 class="text-3xl md:text-5xl font-bold mb-2">
                        Rapport de Revenus
                    </h1>
                    <p class="text-slate-400">Suivi des commissions plateforme (20%) et des bénéfices organisateurs.</p>
                </div>
                <div class="flex flex-wrap gap-3">
                    <button onclick="window.print()"
                        class="px-5 py-2.5 bg-slate-800 hover:bg-slate-700 text-white font-medium rounded-xl border border-slate-700 transition-all flex items-center">
                        <i class="fas fa-print mr-2 text-slate-400"></i>Imprimer
                    </button>
                    <a href="{% url 'admin_dashboard' %}"
                        class="px-5 py-2.5 bg-yellow-400 hover:bg-yellow-300 text-slate-900 font-bold rounded-xl transition-all shadow-[0_0_15px_rgba(250,204,21,0.2)] flex items-center">
                        <i class="fas fa-arrow-left mr-2"></i>Dashboard
                    </a>
                </div>
            </div>
        </div>
    </section>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
        <!-- Summary Cards -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
            <!-- Total Sales -->
            <div
                class="bg-slate-800/50 backdrop-blur-md border border-slate-700 rounded-3xl p-8 relative overflow-hidden group">
                <div class="absolute top-0 right-0 w-32 h-32 bg-blue-500/5 rounded-full blur-3xl -mr-10 -mt-10"></div>
                <div class="flex items-center justify-between mb-6">
                    <div
                        class="w-12 h-12 bg-blue-500/10 rounded-2xl flex items-center justify-center border border-blue-500/20">
                        <i class="fas fa-chart-line text-blue-400 text-xl"></i>
                    </div>
                </div>
                <p class="text-xs font-bold tracking-widest text-slate-500 uppercase mb-1">Ventes Totales (Brut)</p>
                <div class="flex items-baseline gap-2">
                    <span class="text-4xl font-black text-white">${{ total_sales|floatformat:2 }}</span>
                </div>
            </div>

            <!-- Platform Rev -->
            <div
                class="bg-slate-800/80 backdrop-blur-md border border-yellow-400/30 rounded-3xl p-8 relative overflow-hidden group shadow-[0_0_30px_rgba(250,204,21,0.05)]">
                <div class="absolute top-0 right-0 w-32 h-32 bg-yellow-400/5 rounded-full blur-3xl -mr-10 -mt-10"></div>
                <div class="flex items-center justify-between mb-6">
                    <div
                        class="w-12 h-12 bg-yellow-400/10 rounded-2xl flex items-center justify-center border border-yellow-400/20">
                        <i class="fas fa-percentage text-yellow-400 text-xl"></i>
                    </div>
                    <span
                        class="px-2 py-1 bg-yellow-400 text-slate-900 text-[10px] font-black rounded uppercase">Commission
                        20%</span>
                </div>
                <p class="text-xs font-bold tracking-widest text-slate-400 uppercase mb-1">Revenu Plateforme</p>
                <div class="flex items-baseline gap-2">
                    <span class="text-4xl font-black text-yellow-400">${{ platform_revenue|floatformat:2 }}</span>
                </div>
            </div>

            <!-- Organizer Profit -->
            <div
                class="bg-slate-800/50 backdrop-blur-md border border-slate-700 rounded-3xl p-8 relative overflow-hidden group">
                <div class="absolute top-0 right-0 w-32 h-32 bg-emerald-500/5 rounded-full blur-3xl -mr-10 -mt-10">
                </div>
                <div class="flex items-center justify-between mb-6">
                    <div
                        class="w-12 h-12 bg-emerald-500/10 rounded-2xl flex items-center justify-center border border-emerald-500/20">
                        <i class="fas fa-university text-emerald-400 text-xl"></i>
                    </div>
                </div>
                <p class="text-xs font-bold tracking-widest text-slate-500 uppercase mb-1">Part des Compagnies</p>
                <div class="flex items-baseline gap-2">
                    <span class="text-4xl font-black text-white">${{ organizer_profit|floatformat:2 }}</span>
                </div>
            </div>
        </div>

        <!-- Breakdown Table -->
        <div class="bg-slate-800/50 backdrop-blur-md border border-slate-700 rounded-3xl overflow-hidden shadow-2xl">
            <div class="p-6 border-b border-slate-700 bg-slate-800/30">
                <h2 class="text-xl font-bold text-white flex items-center">
                    <i class="fas fa-table mr-3 text-yellow-400"></i>Ventilation par Jeu
                </h2>
            </div>

            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-slate-700/50">
                    <thead class="bg-slate-900/50">
                        <tr>
                            <th
                                class="px-6 py-4 text-left text-[10px] font-bold text-slate-500 uppercase tracking-widest">
                                Jeu / Organisateur</th>
                            <th
                                class="px-6 py-4 text-left text-[10px] font-bold text-slate-500 uppercase tracking-widest">
                                Ventes (100%)</th>
                            <th
                                class="px-6 py-4 text-left text-[10px] font-bold text-slate-500 uppercase tracking-widest">
                                Plateforme (20%)</th>
                            <th
                                class="px-6 py-4 text-left text-[10px] font-bold text-slate-500 uppercase tracking-widest text-emerald-500">
                                Net Organisateur</th>
                            <th
                                class="px-6 py-4 text-right text-[10px] font-bold text-slate-500 uppercase tracking-widest">
                                Actions</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-slate-700/30">
                        {% for item in game_revenues %}
                        <tr class="hover:bg-slate-700/20 transition-colors group">
                            <td class="px-6 py-5">
                                <div class="flex items-center">
                                    <div
                                        class="w-10 h-10 bg-slate-900 rounded-lg border border-slate-700 flex items-center justify-center mr-4">
                                        <i class="fas fa-dice text-blue-400"></i>
                                    </div>
                                    <div>
                                        <div class="text-sm font-bold text-white">{{ item.game.name }}</div>
                                        <div class="text-[10px] text-slate-500 font-medium uppercase">
                                            {{item.game.company.name }}</div>
                                    </div>
                                </div>
                            </td>
                            <td class="px-6 py-5">
                                <div class="text-sm font-bold text-white">${{ item.total_sales|floatformat:2 }}</div>
                            </td>
                            <td class="px-6 py-5">
                                <div class="text-sm font-bold text-orange-400">-${{
                                    item.platform_fee_amount|floatformat:2 }}</div>
                            </td>
                            <td class="px-6 py-5">
                                <div class="text-sm font-bold text-emerald-400">${{ item.organizer_profit|floatformat:2
                                    }}</div>
                            </td>
                            <td class="px-6 py-5 text-right">
                                <button
                                    class="w-8 h-8 flex items-center justify-center bg-slate-700 text-white rounded-lg hover:bg-yellow-400 hover:text-slate-900 transition-all border border-slate-600">
                                    <i class="fas fa-eye text-xs"></i>
                                </button>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="5" class="px-6 py-20 text-center">
                                <div
                                    class="w-20 h-20 bg-slate-900 border border-slate-700 rounded-full flex items-center justify-center mx-auto mb-6">
                                    <i class="fas fa-inbox text-slate-600 text-2xl"></i>
                                </div>
                                <h3 class="text-xl font-bold text-white mb-2">Aucune donnée</h3>
                                <p class="text-slate-500 max-w-xs mx-auto text-sm">Il n'y a pour le moment aucun flux
                                    financier enregistré sur les jeux.</p>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                    <tfoot class="bg-slate-900/80">
                        <tr>
                            <td class="px-6 py-4 text-xs font-bold text-slate-400 uppercase tracking-widest">TOTAUX</td>
                            <td class="px-6 py-4 text-sm font-black text-white">${{ total_sales|floatformat:2 }}</td>
                            <td class="px-6 py-4 text-sm font-black text-yellow-400">-${{ platform_revenue|floatformat:2
                                }}</td>
                            <td class="px-6 py-4 text-sm font-black text-emerald-400">${{ organizer_profit|floatformat:2
                                }}</td>
                            <td></td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>
    </div>
</div>

<style>
    @media print {
        .bg-[#0f172a] {
            background-color: white !important;
            color: black !important;
        }

        .text-white {
            color: black !important;
        }

        .bg-slate-800\/50,
        .bg-slate-900\/50,
        .bg-slate-800\/80 {
            background: none !important;
            border: 1px solid #ddd !important;
        }

        .absolute,
        .btn,
        a[href*="admin_dashboard"],
        .inline-flex,
        .fa-chart-bar,
        button {
            display: none !important;
        }

        .max-w-7xl {
            max-width: 100% !important;
            margin: 0 !important;
            padding: 0 !important;
        }

        table {
            border-collapse: collapse !important;
            width: 100% !important;
        }

        th,
        td {
            border: 1px solid #eee !important;
            color: black !important;
        }

        .text-yellow-400,
        .text-emerald-400,
        .text-blue-400,
        .text-orange-400 {
            color: black !important;
            font-weight: bold !important;
        }

        .rounded-3xl,
        .rounded-2xl,
        .rounded-xl {
            border-radius: 0 !important;
        }

        .shadow-2xl,
        .shadow-lg,
        .shadow-sm {
            box-shadow: none !important;
        }
    }
</style>
{% endblock %}