{% extends 'base.html' %}

{% block title %}Winners - WINNING TICKET{% endblock %}

{% block content %}
<div class="container py-5">
    <!-- Page Header -->
    <div class="text-center mb-5">
        <h1 class="display-4 fw-bold mb-3">üéâ NOS GAGNANTS üéâ</h1>
        <p class="lead text-muted">Aujourd'hui est peut-√™tre votre jour de chance ! D√©couvrez qui a d√©j√† gagn√©.</p>
    </div>

    {% if top_winners %}
    <!-- Featured Winner (The latest biggest winner) -->
    {% with biggest_winner=top_winners.0 %}
    <div class="card border-warning shadow-lg mb-5 overflow-hidden">
        <div class="card-header bg-warning text-dark py-3">
            <h3 class="mb-0 text-center fw-bold">
                <i class="fas fa-crown me-2"></i> DERNIER GRAND GAGNANT
            </h3>
        </div>
        <div class="card-body p-4 p-lg-5">
            <div class="row align-items-center">
                <div class="col-md-4 text-center mb-4 mb-md-0">
                    <div class="position-relative">
                        <div class="winner-badge-main">
                            <i class="fas fa-user-circle fa-7x text-primary opacity-25"></i>
                            <div class="trophy-overlay">
                                <i class="fas fa-trophy text-warning"></i>
                            </div>
                        </div>
                        <div class="mt-4">
                            <h2 class="text-primary fw-bold">
                                {% if biggest_winner.user.first_name %}
                                    {{ biggest_winner.user.first_name }}
                                {% else %}
                                    {{ biggest_winner.user.username }}
                                {% endif %}
                            </h2>
                            <p class="text-muted text-uppercase letter-spacing-1">
                                <i class="fas fa-certificate me-1 text-success"></i>
                                Gagnant V√©rifi√©
                            </p>
                        </div>
                    </div>
                </div>
                <div class="col-md-8">
                    <div class="winner-details ps-md-4">
                        <div class="display-2 text-success fw-bold mb-3">
                            ${{ biggest_winner.prize_amount|floatformat:2|default:"0.00" }}
                        </div>
                        <h4 class="mb-4 text-primary">
                            {{ biggest_winner.draw.game.name }} ‚Ä¢ 
                            {{ biggest_winner.draw.draw_date|date:"F d, Y" }}
                        </h4>

                        <div class="mb-4">
                            <h5 class="text-muted text-uppercase small fw-bold mb-3">Num√©ros gagnants:</h5>
                            <div class="d-flex flex-wrap gap-2">
                                {% if biggest_winner.draw.winning_numbers %}
                                    {% for num in biggest_winner.draw.winning_numbers %}
                                    <span class="number-ball">{{ num }}</span>
                                    {% endfor %}
                                {% endif %}
                                {% if biggest_winner.draw.winning_powerball %}
                                <span class="number-ball powerball">{{ biggest_winner.draw.winning_powerball }}</span>
                                {% endif %}
                            </div>
                        </div>

                        <div class="alert bg-light border-0 py-3 px-4 rounded-4">
                            <p class="mb-0 fs-5 italic">
                                <i class="fas fa-quote-left text-warning opacity-50 me-2"></i>
                                "C'est un r√™ve qui devient r√©alit√© ! Merci Winning Ticket."
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endwith %}

    <!-- Recent Winners Grid -->
    <h2 class="text-center fw-bold mb-5 section-title">PLUS DE GAGNANTS</h2>
    <div class="row g-4 mb-5">
        {% for winner in top_winners %}
        {% if not forloop.first %}
        <div class="col-md-6 col-lg-4">
            <div class="card h-100 shadow-sm winner-card-hover border-0">
                <div class="card-body text-center p-4">
                    <div class="winner-avatar mb-4">
                        <div class="position-relative d-inline-block">
                            <i class="fas fa-user-circle fa-5x text-primary opacity-25"></i>
                            <span class="badge bg-success position-absolute bottom-0 end-0 rounded-pill px-3">WIN</span>
                        </div>
                    </div>

                    <h5 class="mb-1 fw-bold">
                        {% if winner.user.first_name %}
                            {{ winner.user.first_name }} {{ winner.user.last_name|slice:":1" }}.
                        {% else %}
                            {{ winner.user.username }}
                        {% endif %}
                    </h5>

                    <div class="h3 text-success fw-bold mb-3">
                        ${{ winner.prize_amount|floatformat:0|default:"0" }}
                    </div>

                    <div class="mb-4">
                        <span class="badge bg-primary-subtle text-primary border border-primary-subtle px-3 py-2 rounded-pill small mb-1">
                            {{ winner.draw.game.name|default:"Jeu inconnu" }}
                        </span>
                        <div class="text-muted small mt-2">
                            <i class="fas fa-calendar-alt me-1"></i> 
                            {{ winner.draw.draw_date|date:"d M, Y"|default:"Date inconnue" }}
                        </div>
                    </div>

                    <div class="winning-combo-small mb-0">
                        {% if winner.draw.winning_numbers %}
                            {% for num in winner.draw.winning_numbers|slice:":5" %}
                            <span class="badge bg-light text-dark border fw-normal">{{ num }}</span>
                            {% endfor %}
                        {% else %}
                            <span class="badge bg-light text-dark border fw-normal">-</span>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
        {% endfor %}
    </div>
    {% else %}
    <div class="text-center py-5 my-5">
        <div class="mb-4">
            <i class="fas fa-trophy fa-5x text-muted opacity-25"></i>
        </div>
        <h2 class="text-muted">Aucun gagnant pour le moment</h2>
        <p class="lead text-muted mb-4">Soyez le premier √† figurer dans notre galerie des gagnants !</p>
        <a href="{% url 'games' %}" class="btn btn-primary btn-lg px-5 rounded-pill">Jouer Maintenant</a>
    </div>
    {% endif %}

    <!-- Winner Statistics -->
    <div class="card mb-5 border-0 shadow-sm rounded-4 overflow-hidden">
        <div class="card-header bg-dark text-white py-4 text-center">
            <h3 class="mb-0 fw-bold">
                <i class="fas fa-chart-line me-2 text-warning"></i> CHIFFRES CL√âS
            </h3>
        </div>
        <div class="card-body bg-light p-5">
            <div class="row text-center">
                <div class="col-md-4 mb-4 mb-md-0">
                    <div class="stat-box">
                        <div class="display-4 fw-bold text-primary">
                            {{ top_winners.count|default:0|default:"0" }}
                        </div>
                        <p class="text-muted mb-0 fw-bold text-uppercase small">Grands Gagnants</p>
                    </div>
                </div>
                <div class="col-md-4 mb-4 mb-md-0">
                    <div class="stat-box">
                        <div class="display-4 fw-bold text-success">98%</div>
                        <p class="text-muted mb-0 fw-bold text-uppercase small">Paiements Rapides</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="stat-box">
                        <div class="display-4 fw-bold text-warning">24/7</div>
                        <p class="text-muted mb-0 fw-bold text-uppercase small">Support Gagnants</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- How Winners Claim Prizes -->
    <div class="row g-4 mb-5">
        <div class="col-lg-6">
            <div class="card h-100 border-0 shadow-sm rounded-4">
                <div class="card-header bg-white border-bottom py-3">
                    <h5 class="mb-0 fw-bold">
                        <i class="fas fa-shield-alt me-2 text-primary"></i> Comment r√©clamer son prix
                    </h5>
                </div>
                <div class="card-body p-4">
                    <div class="process-list">
                        <div class="process-item d-flex gap-3 mb-4">
                            <div class="process-icon bg-success-subtle text-success">1</div>
                            <div>
                                <h6 class="fw-bold mb-1">V√©rification Automatique</h6>
                                <p class="text-muted small mb-0">Vos gains sont cr√©dit√©s instantan√©ment sur votre compte
                                    Winning Ticket.</p>
                            </div>
                        </div>
                        <div class="process-item d-flex gap-3 mb-4">
                            <div class="process-icon bg-primary-subtle text-primary">2</div>
                            <div>
                                <h6 class="fw-bold mb-1">Demande de Retrait</h6>
                                <p class="text-muted small mb-0">Choisissez votre mode de paiement pr√©f√©r√© (Virement,
                                    Mobile, etc.).</p>
                            </div>
                        </div>
                        <div class="process-item d-flex gap-3">
                            <div class="process-icon bg-warning-subtle text-warning">3</div>
                            <div>
                                <h6 class="fw-bold mb-1">Transfert S√©curis√©</h6>
                                <p class="text-muted small mb-0">Recevez vos fonds sous 24 √† 48 heures apr√®s
                                    v√©rification.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-6">
            <div class="card h-100 border-0 shadow-sm rounded-4 bg-primary text-white">
                <div class="card-body p-5">
                    <h3 class="fw-bold mb-4">Pr√™t √† changer de vie ?</h3>
                    <p class="opacity-75 lead mb-5">Le prochain nom sur cette liste pourrait √™tre le v√¥tre. Tentez votre
                        chance d√®s maintenant !</p>
                    <div class="d-grid">
                        <a href="{% url 'games' %}" class="btn btn-gold btn-lg py-3 rounded-pill fw-bold">
                            ACHETER UN TICKET
                        </a>
                    </div>
                    <div class="mt-4 text-center">
                        <small class="opacity-50"><i class="fas fa-lock me-1"></i> Plateforme s√©curis√©e &
                            certifi√©e</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .winner-badge-main {
        width: 160px;
        height: 160px;
        margin: 0 auto;
        display: flex;
        align-items: center;
        justify-content: center;
        background: #f8f9fa;
        border-radius: 50%;
        position: relative;
        border: 4px solid #ffd700;
    }

    .trophy-overlay {
        position: absolute;
        top: -10px;
        right: -10px;
        background: white;
        width: 60px;
        height: 60px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.8rem;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        border: 2px solid #ffd700;
    }

    .number-ball {
        width: 45px;
        height: 45px;
        background: white;
        border: 2px solid #0d6efd;
        color: #0d6efd;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
    }

    .number-ball.powerball {
        background: #ffd700;
        border-color: #ffd700;
        color: #000;
    }

    .winner-card-hover {
        transition: all 0.3s ease;
    }

    .winner-card-hover:hover {
        transform: translateY(-10px);
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1) !important;
    }

    .process-icon {
        width: 40px;
        height: 40px;
        min-width: 40px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        font-size: 1.2rem;
    }

    .btn-gold {
        background: #ffd700;
        color: #000;
        border: none;
        transition: all 0.3s ease;
    }

    .btn-gold:hover {
        background: #ffc107;
        color: #000;
        transform: translateY(-2px);
    }

    .section-title::after {
        content: '';
        display: block;
        width: 60px;
        height: 4px;
        background: #ffd700;
        margin: 15px auto;
        border-radius: 2px;
    }

    .italic {
        font-style: italic;
    }

    .letter-spacing-1 {
        letter-spacing: 1px;
    }
</style>
{% endblock %}